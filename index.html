<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JS Particle System</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="robots" content="index, follow">
    <meta name="description" content="A simple particle system implemented in JavaScript">
    <link rel="canonical" href="https://particle.evanpblack.com/">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="particle.css" />

    <script src="util.js"></script>
    <script src="vector.js"></script>
    <script src="actorFactory.js"></script>
    <script src="actors/nullActor.js"></script>
    <script src="actors/produceActor.js"></script>
    <script src="actors/killActor.js"></script>
    <script src="actors/explodeActor.js"></script>

    <script src="particle.js"></script>
    <script src="particleSystem.js"></script>
    <script src="stats.js"></script>

    <script src="canvasInteractor.js"></script>
    <script>
        var setupModal;
        var interactor;

        window.onload = function () {
            var canvas = document.getElementById("particleCanvas");
            var bounds = canvas.getBoundingClientRect();
            var tooltip = {
                enabled: true,
                shown: false,
                activeObject: null,
                element: document.getElementById("tooltip"),
                offset: {
                    x: 5,
                    y: 5
                },
                show: function (x, y) {
                    this.element.style.top = y + this.offset.y + "px";
                    this.element.style.left = x + this.offset.y + "px";
                    if (!this.shown) {
                        this.element.style.display = "block";
                        this.shown = true;
                    }
                },
                hide: function () {
                    if (this.shown) {
                        this.element.style.display = "none";
                        this.shown = false;
                    }
                }
            };
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            setupModal = {
                modal: document.getElementById("setupModal"),
                numParticles: document.getElementById("numParticles"),
                enableTooltip: document.getElementById("enableTooltip"),
                numActors: document.getElementById("numActors"),
                useSounds: document.getElementById("useSounds"),
                allowRndActors: document.getElementById("allowRndActors"),
                submit: document.getElementById("setupModalSubmit"),
                hide: function () {
                    this.modal.style.display = "none";
                }
            };

            setupModal.submit.onclick = function () {
                setupModal.hide();

                var particles = setupModal.numParticles.value || 500;
                var actors = setupModal.numActors.value || 10;

                var sounds = undefined;
                if (setupModal.useSounds.checked) {
                    sounds = {
                        explode: new Audio('sounds/explode.mp3')
                    };
                }
                var useRndActors = setupModal.allowRndActors.checked;

                var system = new ParticleSystem(canvas.width, canvas.height, particles, actors, sounds, useRndActors);

                interactor = new CanvasInteractor(canvas, sounds, system);
                canvas.onclick = function (e) {
                    var xPos = e.clientX - bounds.left;
                    var yPos = e.clientY - bounds.top;

                    interactor.insertParticle(new Particle(xPos, yPos, randomRange(-2, 2), randomRange(-2, 2)));
                };

                if (setupModal.enableTooltip.checked) {
                    canvas.onmousemove = function (e) {
                        var xPos = e.clientX - bounds.left;
                        var yPos = e.clientY - bounds.top;
                        var object = interactor.particleSystem.getObjectAtLocation(xPos, yPos);
                        if (object !== null) {
                            tooltip.activeObject = object;
                            tooltip.element.innerHTML = makeStatsString(object);
                            tooltip.show(xPos + 5, yPos + 5);
                        } else {
                            tooltip.hide();
                            tooltip.activeObject = null;
                        }
                    };

                    interactor.particleSystem.onTick = function () {
                        if (tooltip.shown) {
                            tooltip.element.innerHTML = makeStatsString(tooltip.activeObject);
                        }
                    }
                }
                document.onkeypress = function (e) {
                    if (e.key === " ") {
                        interactor.playPause()
                    }
                }
            };
        };
    </script>
</head>
<body>
<!-- Filled with stats by js-->
<div id="tooltip" style="display: none; position: fixed; z-index: 2"></div>
<canvas id="particleCanvas" width="1000" height="700"></canvas>
<div id="setupModal" class="modal">
    <div class="modal-content">
        <h2>Controls</h2>
        <div class="modal-controls">
            <ul>
                <li>Click to create a particle</li>
                <li>Space to pause</li>
            </ul>
        </div>

        <h2>Settings</h2>

        <h3>Particles</h3>
        <div class="form-group">
            <label for="numParticles">Particles:</label>
            <output id="numParticlesOutput">500</output>
            <input
                    type="range"
                    class="form-control-range"
                    min="0"
                    max="2000"
                    value="500"
                    oninput="numParticlesOutput.value = numParticles.value"
                    id="numParticles">
        </div>
        <div class="form-group form-check">
            <input type="checkbox" class="form-check-input" id="enableTooltip" checked>
            <label class="form-check-label" for="enableTooltip">Enable Tooltips On Mouse Over</label>
        </div>

        <h3>Actors</h3>
        <div class="form-group">
            <label for="numActors">Actors:</label>
            <output id="numActorsOutput">10</output>
            <input
                    type="range"
                    class="form-control-range"
                    min="0"
                    max="50"
                    value="10"
                    oninput="numActorsOutput.value = numActors.value"
                    id="numActors">
        </div>
        <div class="form-group form-check">
            <input type="checkbox" class="form-check-input" id="allowRndActors" checked>
            <label class="form-check-label" for="allowRndActors">Generate Random Actors</label>
        </div>

        <h3>Sounds</h3>
        <div class="form-group form-check">
            <input type="checkbox" class="form-check-input" id="useSounds" checked>
            <label class="form-check-label" for="useSounds">Play Explosion Sounds</label>
        </div>
        <button class="btn btn-lg btn-block" id="setupModalSubmit">Start</button>
    </div>

</div>
</body>
</html>